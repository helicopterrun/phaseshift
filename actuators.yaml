# actuators.yaml

output:
  # TEC output level (writes to PWM number then presses set_pwm)
  - platform: template
    id: tec_output
    type: float
    write_action:
      - number.set:
          id: tec_pl_number
          value: !lambda 'return state;'
      - button.press: set_pwm

  # Cold‚Äêfan compensated output (adjusts fan_cold level and publishes speed)
  - platform: template
    id: cold_fan_compensated_output
    type: float
    write_action:
      - output.set_level:
          id: fan_cold
          level: !lambda 'return state;'
      - sensor.template.publish:
          id: cold_fan_speed
          state: !lambda 'return state * 100.0;'

  # DAC outputs for TEC current limiting
  - platform: mcp4728
    id: vref_a_out
    channel: A
    vref: vdd

  - platform: mcp4728
    id: vref_b_out
    channel: C
    vref: vdd

  - platform: mcp4728
    id: imode_a
    channel: B
    vref: internal
    gain: X1

  - platform: mcp4728
    id: imode_b
    channel: D
    vref: internal
    gain: X1

  # TEC driver control pins
  - platform: gpio
    id: nsleep_a
    pin: GPIO26

  - platform: gpio
    id: nsleep_b
    pin: GPIO18

  - platform: gpio
    id: p_mode
    pin: GPIO19

  # PWM channels for TEC drivers
  - platform: ledc
    id: pwm_a
    pin: GPIO13
    frequency: 19531Hz

  - platform: ledc
    id: pwm_b
    pin: GPIO33
    frequency: 19531Hz

  # PWM channels for fans
  - platform: ledc
    id: fan_hot
    pin: GPIO32
    frequency: 25000Hz

  - platform: ledc
    id: fan_cold
    pin: GPIO25
    frequency: 25000Hz

  - platform: ledc
    id: fan_circ
    pin: GPIO17
    frequency: 25000Hz

switch:
  # Chamber heater relay
  - platform: gpio
    id: heat
    pin: GPIO12
    name: "Chamber Heat"
    inverted: true

  # Fahrenheit/Celsius toggle (compile-time substitution recommended)
  - platform: template
    id: use_fahrenheit
    name: "Use Fahrenheit"
    optimistic: true
    restore_mode: RESTORE_DEFAULT_ON
    on_turn_on:
      - button.press: submit_values
    on_turn_off:
      - button.press: submit_values

  # Allow coil to drop below freezing toggle
  - platform: template
    id: allow_below_freezing
    name: "Allow Coil Below Freezing"
    optimistic: true
    restore_mode: RESTORE_DEFAULT_OFF